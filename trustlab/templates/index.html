{% extends 'layout.html' %}

{% load static %}

{% block title %}
aTLAS
{% endblock %}

{#{% block nav_home %}class="active"{% endblock %}#}

{% block scripts %}
<script src="{% static 'trustlab/scripts/trustlab.js' %}"></script>
<script>
    let scenarios;
    {% if scenarios %}
        scenarios = {{ scenarios_JSON|safe }};
    {% endif %}
    const INDEX_URL = "{{ index_url }}"
    const LAB_URL = "{{ lab_url }}"
</script>
{% endblock %}

{% block body %}
    <div class="component-start" id="c-start">
        <div class="mdl-grid mdl-grid--centered">
            <div class="mdl-cell mdl-cell--9-col mdl-cell--8-col-tablet mdl-cell--4-col-phone">
                <div class="mdl-card mdl-shadow--2dp mdl-card--stretch" style="width: auto;">
                    <div class="mdl-card__title mdl-card--border">
                        <h2 class="mdl-card__title-text">Trust Laboratory</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        <p>
                            This is the access point for a Trust laboratory of Multi-Agent Systems, called aTLAS.<br>
                            <!--Its focus lies on open dynamic Multi-Agent Systems, but you can also use it for other scenarios.-->
                        </p>
                        <p>
                            A wizard will guide you through the process if you click on <i>Specify Scenario</i>.<br>
                            By clicking on <i>Review Results</i> you can review results from finished scenario runs.
                        </p>
                        <div class="mdl-card__actions mdl-card--border">
                            <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect" id="btn-specify-scenario">Specify Scenario</button>
                            <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect neighbour-button" id="btn-pick-results">Review Results</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="component-scenario not-displayed" id="c-pick-results">
        <div class="mdl-grid mdl-grid--centered">
            <div class="mdl-cell mdl-cell--9-col mdl-cell--8-col-tablet mdl-cell--4-col-phone">
                <div class="mdl-card mdl-shadow--2dp mdl-card--stretch" style="width: auto;">
                    <div class="mdl-card__title mdl-card--border">
                        <h2 class="mdl-card__title-text">Trust Laboratory</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        <p>
                            Please type in a valid scenario run ID and proceed.<br>
                        </p>
                        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                          <input class="mdl-textfield__input" type="text" id="scenario_run_id_pick">
                          <label class="mdl-textfield__label" for="scenario_run_id_pick">Scenario Run ID</label>
                          <span id="pick-results-error" class="mdl-textfield__error">Insert a valid Scenario Run ID</span>
                        </div>
                        <div class="mdl-card__actions mdl-card--border">
                            <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect" id="btn-get-results">Get Scenario Run Results</button>
                            <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect neighbour-button" id="btn-cancel-pick">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="component-scenario not-displayed" id="c-scenario">
        <div class="mdl-grid mdl-grid--centered">
            <div class="mdl-cell mdl-cell--9-col mdl-cell--8-col-tablet mdl-cell--4-col-phone">
                <div class="mdl-card mdl-shadow--2dp mdl-card--stretch" style="width: auto;">
                    <div class="mdl-card__title mdl-card--border">
                        <h2 class="mdl-card__title-text">Specify Scenario</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        <p>
                            For demo purposes you can currently only reuse certain prepared scenarios.<br>
                            In future versions you will be able to also create your own scenario here.
                        </p>
                        <p>
                            <b>
                                Please choose a scenario and proceed with starting the laboratory runtime:
                            </b>
                        </p>
                        <form class="mdl-grid">
                        {% csrf_token %}
                            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                              <select class="mdl-textfield__input" id="selector-scenario" name="scenario">
                                <option></option>
                                {% for scenario in scenarios %}
                                <option value="{{scenario.name|safe}}">{{scenario.name|safe}}</option>
                                {% endfor %}
                              </select>
                              <label class="mdl-textfield__label" for="selector-scenario">Scenario</label>
                              <span id="selector-scenario-error" class="mdl-textfield__error">Select a Scenario</span>
                            </div>
                        </form>
                        {% for scenario in scenarios %}
                        <ul class="mdl-list scenario-ul not-displayed" data-scenario="{{scenario.name|safe}}">
                          <li class="mdl-list__item">
                            <span>
                              <span class="mdl-list__item-primary-content">Description</span>
                              <span class="trustlab-li-body">
                                {{scenario.description|safe}}
                              </span>
                            </span>
                          </li>
                          <li class="mdl-list__item">
                            <span>
                              <span class="mdl-list__item-primary-content">Agents</span>
                              <span class="trustlab-li-body">
                                <!-- This scenario includes following Agents: <br> -->
                                {% for agent in scenario.agents %}
                                    {{ agent }}{% if not forloop.last %},{% endif %}
                                {% endfor %}
                              </span>
                            </span>
                          </li>
                          <li class="mdl-list__item">
                            <span>
                              <span class="mdl-list__item-primary-content">Observations</span>
                              <span class="trustlab-li-body">
                                <ol>
                                {% for observation in scenario.observations %}
                                    <li value="{{ observation.observation_id }}">
                                    <!--'{{ observation.sender }}' sends '{{ observation.receiver }}' from author '{{ observation.author }}' with topic '{{ observation.topic }}' the message: {{ observation.message }} -->
                                    '{{ observation.sender }}' sends '{{ observation.receiver }}' after {{ observation.before }}, topic '{{ observation.topic }}', message: {{ observation.message }}
                                    </li>
                                {% endfor %}
                                </ol>
                              </span>
                            </span>
                          </li>
                          <li class="mdl-list__item">
                            <span>
                              <span class="mdl-list__item-primary-content">Trust History</span>
                              <span class="trustlab-li-body">
                                {% for agent, agents_history in scenario.history.items %}
                                    {{ agent }} trusted <br>
                                    <ul>
                                    {% for other_agent, value in agents_history.items %}
                                        <li>
                                        {{ other_agent }} with a trust value of {{ value }}
                                        </li>
                                    {% endfor %}
                                    </ul>
                                    {% if not forloop.last %}<br>{% endif %}
                                {% endfor %}
                              </span>
                            </span>
                          </li>
                          <li class="mdl-list__item">
                            <span>
                              <span class="mdl-list__item-primary-content">Trust Metrics</span>
                              <span class="trustlab-li-body">
                                {% for agent, metrics in scenario.metrics_per_agent.items %}
                                    {{ agent }} uses the metrics: <br>
                                    {% for metric in metrics %}
                                        {{ metric }}{% if not forloop.last %},{% endif %}{% if forloop.last %}<br>{% endif %}
                                    {% endfor %}
                                    {% if not forloop.last %}<br>{% endif %}
                                {% endfor %}
                              </span>
                            </span>
                          </li>
                          {% if scenario.authorities %}
                          <li class="mdl-list__item">
                            <span>
                              <span class="mdl-list__item-primary-content">Authorities</span>
                              <span class="trustlab-li-body">
                                {% for agent, authorities in scenario.authorities.items %}
                                    {% if authorities %}
                                    {{ agent }} considers the following agents as authorities: <br>
                                    {% for authority in authorities %}
                                        {{ authority }}{% if not forloop.last %},{% endif %}{% if forloop.last %}<br>{% endif %}
                                    {% endfor %}
                                    {% if not forloop.last %}<br>{% endif %}
                                    {% endif %}
                                {% endfor %}
                              </span>
                            </span>
                          </li>
                          {% endif %}
                          {% if scenario.topics %}
                          <li class="mdl-list__item">
                            <span>
                              <span class="mdl-list__item-primary-content">Topic Trust</span>
                              <span class="trustlab-li-body">
                                {% for agent, agents_topics in scenario.topics.items %}
                                    {{ agent }} trusts <br>
                                    <ul style="list-style-type:none; padding-inline-start: 1em;">
                                    {% for other_agent, topics in agents_topics.items %}
                                        <li>
                                        {{ other_agent }}
                                        <ul>
                                        {% for topic, value in topics.items %}
                                            <li>
                                             at topic '{{ topic }}' with a trust value of {{ value }}
                                            </li>
                                        {% endfor %}
                                        </ul>
                                        </li>
                                    {% endfor %}
                                    </ul>
                                {% endfor %}
                              </span>
                            </span>
                          </li>
                          {% endif %}
{#                        For each important aspect in the scenario you can print it out here within this list #}
                        </ul>
                        {% endfor %}
                        <div class="mdl-card__actions mdl-card--border">
                            <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect" id="btn-run-scenario">Start laboratory runtime</button>
                            <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect neighbour-button" id="btn-cancel-specify">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="component-runtime not-displayed" id="c-runtime">
        <div class="mdl-grid mdl-grid--centered">
            <div class="mdl-cell mdl-cell--9-col mdl-cell--8-col-tablet mdl-cell--4-col-phone">
                <div class="mdl-card mdl-shadow--2dp mdl-card--stretch" style="width: auto;">
                    <div class="mdl-card__title mdl-card--border">
                        <h2 class="mdl-card__title-text">Laboratory Runtime</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        <p>
                            Please wait while the laboratory is running the chosen scenario.
                        </p>
                        <div id="p2" class="mdl-progress mdl-js-progress mdl-progress__indeterminate"></div>
                        <div id="showing_scenario_run_id">
                            <p style="margin-top: 2em">
                                The scenario run keeps you waiting? With the following details you can access the results also later on.
                            </p>
                            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label trustlab-copy-field">
                              <input class="mdl-textfield__input" type="text" id="scenario_run_id_copyField" readonly>
                              <label class="mdl-textfield__label" for="scenario_run_id_copyField">Scenario Run ID</label>
                            </div>
                            <button class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored" onclick="copy_text_to_clipboard('scenario_run_id_copyField')">
                              <i class="material-icons">content_copy</i>
                            </button>
                            <div class="mdl-layout-spacer"></div>
                            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label trustlab-copy-field">
                              <input class="mdl-textfield__input" type="text" id="scenario_run_url_copyField" readonly>
                              <label class="mdl-textfield__label" for="scenario_run_url_copyField">Scenario Run URL</label>
                            </div>
                            <button class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored" onclick="copy_text_to_clipboard('scenario_run_url_copyField')">
                              <i class="material-icons">content_copy</i>
                            </button>
                        </div>
{#                        <div id="loading_scenario_run_id">#}
{#                            <p>#}
{#                                Getting scenario run ID ...#}
{#                            </p>#}
{#                            <div class="mdl-spinner mdl-js-spinner is-active"></div>#}
{#                        </div>#}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="component-runtime not-displayed" id="c-loadingResults">
        <div class="mdl-grid mdl-grid--centered">
            <div class="mdl-cell mdl-cell--9-col mdl-cell--8-col-tablet mdl-cell--4-col-phone">
                <div class="mdl-card mdl-shadow--2dp mdl-card--stretch" style="width: auto;">
                    <div class="mdl-card__title mdl-card--border">
                        <h2 class="mdl-card__title-text">Getting Scenario Result</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        <p>
                            Please wait while the laboratory is loading your scenario results.
                        </p>
                        <div id="p2" class="mdl-progress mdl-js-progress mdl-progress__indeterminate" style="margin-bottom: 2em"></div>
                        <div class="mdl-card__actions mdl-card--border">
                            <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect"
                                    id="btn-cancel-scenario-results">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="component-runtime not-displayed" id="c-results">
        <div class="mdl-grid mdl-grid--centered">
            <div class="mdl-cell mdl-cell--9-col mdl-cell--8-col-tablet mdl-cell--4-col-phone">
                <div class="mdl-card mdl-shadow--2dp mdl-card--stretch" style="width: auto;">
                    <div class="mdl-card__title mdl-card--border">
                        <h2 class="mdl-card__title-text" id="results_header">Results</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        <p>
                            Your scenario finished!<br>
                            For respective results see forward below:
                        </p>
                        <p>
                            Trust Log:
                        </p>
                        <pre id="trust_log">
                            If you see this text, the logs were unfortunately not passed correctly to your client. (trust_log)
                        </pre>
                        <div id="agents_log_end"></div>

                        <div class="mdl-card__actions mdl-card--border">
                            <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect" id="btn-specify-scenario2">Specify another Scenario</button>
                            <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect neighbour-button" id="btn-pick-results2">Review other Results</button>
                            <div class="mdl-layout-spacer"></div>
                            <button class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored btn-share-results"><i class="material-icons">share</i></button>
                        </div>
                        <div class = "mdl-card__menu">
                            <button class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored btn-share-results">
                              <i class="material-icons">share</i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <dialog class="mdl-dialog" id="share-dialog">
        <p class="mdl-dialog__title">Share Results</p>
        <div class="mdl-dialog__content">
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label trustlab-copy-field">
              <input class="mdl-textfield__input" type="text" id="scenario_run_id_copyField_results" readonly>
              <label class="mdl-textfield__label" for="scenario_run_id_copyField_results">Scenario Run ID</label>
            </div>
            <button class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored" onclick="copy_text_to_clipboard('scenario_run_id_copyField_results')">
              <i class="material-icons">content_copy</i>
            </button>
            <div class="mdl-layout-spacer"></div>
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label trustlab-copy-field">
              <input class="mdl-textfield__input" type="text" id="scenario_run_url_copyField_results" readonly>
              <label class="mdl-textfield__label" for="scenario_run_url_copyField_results">Scenario Run URL</label>
            </div>
            <button class="mdl-button mdl-js-button mdl-button--icon mdl-button--colored" onclick="copy_text_to_clipboard('scenario_run_url_copyField_results')">
              <i class="material-icons">content_copy</i>
            </button>
        </div>
        <div class="mdl-dialog__actions">
            <button id="close-share-dialog" type="button" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect close">OK</button>
        </div>
    </dialog>
{% endblock %}